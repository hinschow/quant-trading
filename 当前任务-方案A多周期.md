# 当前任务：方案A + 多时间周期回测

**更新时间**: 2025-10-28 下午
**状态**: ✅ 准备就绪，等待本地执行

---

## ✅ 已完成

### 1. 方案A参数优化

**目标**：基于v4.0分析，采用保守优化策略

**调整内容**：

| 参数 | v4.0 | 方案A | 改善 |
|------|------|-------|------|
| **趋势策略止损** | 3.5% | 3% | ✅ 收紧 |
| **趋势策略止盈** | 7% | 5% | ✅ 降低目标 |
| **持仓时间** | 96h | 60h | ✅ 缩短 |
| **BTC止损/止盈** | 4%/8% | 3%/5% | ✅ 收紧 |
| **ETH止损/止盈** | 4%/8% | 3%/5% | ✅ 收紧 |
| **SOL止损/止盈** | 3.5%/7% | 2.5%/4.5% | ✅ 收紧 |
| **SOL信号阈值** | 55 | 60 | ✅ 提高质量 |

### 2. 多时间周期支持

**新增功能**：

✅ `run_multi_timeframe_backtest.py`
- 支持15m、30m、1h三个时间周期
- 自动计算所需K线数量（60天数据）
- 自动整理结果到分类目录

✅ `analyze_multi_timeframe.py`
- 多周期对比分析
- 按品种和整体对比
- 自动推荐最佳周期

✅ 结果目录结构
```
backtest_results/multi_timeframe/
├── 15m/  # 15分钟周期结果
├── 30m/  # 30分钟周期结果
├── 1h/   # 1小时周期结果
└── metadata.json  # 元数据
```

### 3. 完整文档

✅ [方案A多周期回测指南.md](方案A多周期回测指南.md)
- 参数调整说明
- 使用步骤
- 分析方法
- 决策树

---

## 🎯 下一步：在本地Mac执行

### 快速执行流程

```bash
# 1. 同步代码
cd /Volumes/datedisk\ 1/code/quant-trading
git pull

# 2. 清理缓存
./cleanup.sh

# 3. 运行多周期回测（预计10-20分钟）
python3 run_multi_timeframe_backtest.py

# 4. 分析结果
python3 analyze_multi_timeframe.py

# 5. 提交结果
git add backtest_results/multi_timeframe/
git commit -m "Multi-timeframe backtest results: Plan A"
git push
```

---

## 📊 预期结果

### 方案A vs v4.0 预期改善

| 指标 | v4.0 实际 | 方案A 预期 | 改善幅度 |
|------|----------|-----------|---------|
| 总收益率 | -8.88% | **0~+3%** | +9~12% ✅ |
| 平均胜率 | 35% | **40~45%** | +5~10% ✅ |
| 盈亏比 | <1 | **>1** | 改善 ✅ |
| 单笔最大亏损 | -10.6% | **<-5%** | 降低风险 ✅ |

### 不同时间周期预期

| 周期 | 交易次数预期 | 胜率预期 | 收益预期 | 推荐度 |
|------|------------|---------|---------|-------|
| **15m** | 30-50次 | 35-40% | -2~+5% | ⭐⭐⭐ |
| **30m** | 15-25次 | 38-43% | 0~+6% | ⭐⭐⭐⭐ |
| **1h** | 8-15次 | 40-45% | +1~+7% | ⭐⭐⭐⭐⭐ |

**推荐优先级**：1h > 30m > 15m

---

## 🔍 关键验证点

### 1. 信号强度（最重要）

```bash
# 验证信号过滤是否生效
for tf in 15m 30m 1h; do
    echo "=== $tf 周期 BTC ==="
    grep "BUY" backtest_results/multi_timeframe/$tf/backtest_trades_BTC_USDT_$tf.csv | \
        cut -d',' -f7 | sort -n
done
```

**期望**：
- BTC/ETH：全部 ≥ 65
- SOL：全部 ≥ 60 ⬆️（从55提高）

### 2. 止损有效性

检查单笔最大亏损：
- BTC/ETH：应该 < 4%（目标3%止损）
- SOL：应该 < 3.5%（目标2.5%止损）

### 3. 止盈达成率

检查盈利交易中，达到止盈目标的比例：
- 目标：>50% 的盈利交易达到5%/4.5%
- 相比v4.0的7-8%应该更容易达到

### 4. 持仓时间分布

- 平均持仓应该 < 60小时
- 相比v4.0的60-70小时应该缩短

---

## 💡 优化逻辑回顾

### 为什么这样调整？

#### 1. 降低止盈（7-8% → 5-4.5%）
**问题**：v4.0 止盈目标过高，在震荡市难以达到
**数据**：BTC最大盈利589 USDT（5.9%），勉强达到8%目标的很少
**解决**：降低到5%，增加盈利交易成功率

#### 2. 收紧止损（3.5-4% → 3-2.5%）
**问题**：虽然放宽了止损，但仍有大额亏损（SOL -10.6%）
**数据**：实际止损经常被突破，需要更及时止损
**解决**：收紧到3%/2.5%，防止亏损扩大

#### 3. 缩短持仓（96h → 60h）
**问题**：持仓时间过长（平均60-70小时），增加风险
**数据**：长时间持仓在震荡市容易被套
**解决**：缩短到60小时上限，快进快出

#### 4. 提高SOL阈值（55 → 60）
**问题**：SOL从最佳变最差，胜率45% → 25%
**数据**：4笔交易中只有1笔盈利
**解决**：提高阈值到60，减少低质量交易

### 为什么要测试多周期？

**原因**：
1. 不同周期捕捉不同的价格波动
2. 策略可能在某个周期表现更好
3. 找到最适合的交易频率

**预期**：
- 15m：交易频繁，适合短线
- 30m：平衡型
- 1h：趋势跟随（原策略），预计表现最好

---

## 🎬 执行检查清单

### 回测前

- [ ] ✅ 已同步最新代码（`git pull`）
- [ ] ✅ 已清理Python缓存（`./cleanup.sh`）
- [ ] ✅ 确认配置是方案A参数
- [ ] ✅ 网络连接正常（需要下载数据）

### 回测中

- [ ] 观察是否有错误信息
- [ ] 注意信号强度是否符合预期
- [ ] 确认交易次数是否合理

### 回测后

- [ ] ✅ 运行 `analyze_multi_timeframe.py`
- [ ] ✅ 检查信号强度分布
- [ ] ✅ 对比三个周期的表现
- [ ] ✅ 确定最佳时间周期
- [ ] ✅ 提交结果到服务器

---

## 📈 成功判断标准

### 最低目标（可接受）✅
- [ ] 至少一个周期总收益 > 0%
- [ ] 至少一个周期胜率 > 40%
- [ ] 至少一个周期盈亏比 > 1.0

### 理想目标 ⭐
- [ ] 最佳周期总收益 > +3%
- [ ] 最佳周期胜率 > 42%
- [ ] 最佳周期盈亏比 > 1.1

### 优秀目标 ⭐⭐
- [ ] 最佳周期总收益 > +5%
- [ ] 最佳周期胜率 > 45%
- [ ] 最佳周期盈亏比 > 1.2

---

## 🔄 如果结果不理想

### 情况A：稍有改善但未达标

**行动**：
1. 微调参数（止损±0.5%，止盈±0.5%）
2. 调整信号阈值（±5）
3. 测试其他周期（4h、1d）

### 情况B：完全无改善

**行动**：
1. 重新审视策略逻辑
2. 考虑市场环境因素（熊市/牛市）
3. 尝试完全不同的策略方向
4. 或者接受当前市场不适合趋势策略

### 情况C：某个品种很好，其他很差

**行动**：
1. 专注于表现好的品种
2. 分析表现差的品种特性
3. 为不同品种设置完全不同的参数

---

## 📞 完成后

回测和分析完成后，在本地执行：

```bash
# 提交多周期结果
git add backtest_results/multi_timeframe/
git commit -m "Multi-timeframe backtest results: Plan A (15m/30m/1h)

方案A测试结果：

15m 周期：
- BTC: 收益率 X%, 胜率 X%, 交易 X次
- ETH: 收益率 X%, 胜率 X%, 交易 X次
- SOL: 收益率 X%, 胜率 X%, 交易 X次
- 总收益: X%

30m 周期：
- BTC: 收益率 X%, 胜率 X%, 交易 X次
- ETH: 收益率 X%, 胜率 X%, 交易 X次
- SOL: 收益率 X%, 胜率 X%, 交易 X次
- 总收益: X%

1h 周期：
- BTC: 收益率 X%, 胜率 X%, 交易 X次
- ETH: 收益率 X%, 胜率 X%, 交易 X次
- SOL: 收益率 X%, 胜率 X%, 交易 X次
- 总收益: X%

最佳周期: X
推荐原因: [填写]"

git push
```

然后告诉我结果，我会：
1. 分析多周期对比数据
2. 评估方案A的效果
3. 提供下一步优化建议

---

**创建时间**: 2025-10-28
**任务状态**: ⏳ 等待本地执行
**预计耗时**: 15-25 分钟
