# å¤šæ•°æ®æºæ”¯æŒæ–‡æ¡£

**ç‰ˆæœ¬**: v7.2.1
**å®Œæˆæ—¶é—´**: 2025-10-28

---

## åŠŸèƒ½æ¦‚è¿°

ç³»ç»Ÿç°åœ¨æ”¯æŒå¤šæ•°æ®æºæ¶æ„ï¼Œ**ä¼˜å…ˆä½¿ç”¨Hyperliquidï¼Œå¦‚æœä¸æ”¯æŒåˆ™è‡ªåŠ¨å›é€€åˆ°Binance**ã€‚

### æ ¸å¿ƒç‰¹æ€§

1. **è‡ªåŠ¨æ•°æ®æºåˆ‡æ¢**
   - ä¼˜å…ˆå°è¯•ä»Hyperliquidè·å–æ•°æ®
   - å¦‚æœHyperliquidä¸æ”¯æŒè¯¥äº¤æ˜“å¯¹ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°Binance
   - é€æ˜åˆ‡æ¢ï¼Œç”¨æˆ·æ— éœ€å¹²é¢„

2. **ç”¨æˆ·è‡ªå®šä¹‰äº¤æ˜“å¯¹**
   - åœ¨`config/strategy_params.py`ä¸­é…ç½®`TRADING_SYMBOLS`åˆ—è¡¨
   - ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©æœ€ä½³æ•°æ®æº
   - æ”¯æŒä»»æ„äº¤æ˜“å¯¹ç»„åˆ

3. **æ•°æ®æºæ ‡è®°**
   - ç³»ç»Ÿè®°å½•æ¯ä¸ªäº¤æ˜“å¯¹ä½¿ç”¨çš„æ•°æ®æº
   - å¯é€šè¿‡`client.data_source`å­—å…¸æŸ¥çœ‹
   - æ—¥å¿—ä¸­æ˜¾ç¤ºæ•°æ®æºä¿¡æ¯

---

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½®äº¤æ˜“å¯¹

åœ¨ [config/strategy_params.py](config/strategy_params.py:202-209) ä¸­ä¿®æ”¹`TRADING_SYMBOLS`ï¼š

```python
# ==================== äº¤æ˜“å¯¹é…ç½® ====================
# ç”¨æˆ·å¯è‡ªå®šä¹‰è¦äº¤æ˜“çš„äº¤æ˜“å¯¹åˆ—è¡¨
# ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•ä»Hyperliquidè·å–æ•°æ®ï¼Œå¦‚æœä¸å¯ç”¨åˆ™å›é€€åˆ°Binance
TRADING_SYMBOLS = [
    'BTC/USDT',
    'ETH/USDT',
    'SOL/USDT',
    # å¯ä»¥æ·»åŠ ä»»æ„äº¤æ˜“å¯¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æ•°æ®æº
    # 'DOGE/USDT',
    # 'XRP/USDT',
    # 'ADA/USDT',
]
```

### 2. åˆå§‹åŒ–å®¢æˆ·ç«¯

```python
from utils.hyperliquid_client import HyperliquidClient

# å¯ç”¨Binanceå¤‡ç”¨æ•°æ®æºï¼ˆé»˜è®¤å¯ç”¨ï¼‰
client = HyperliquidClient(
    enable_persistence=True,
    enable_binance_fallback=True  # å¯ç”¨Binanceå›é€€
)
```

### 3. è·å–å¸‚åœºæ•°æ®

```python
# è·å–å¸‚åœºæ•°æ®ï¼ˆè‡ªåŠ¨é€‰æ‹©æ•°æ®æºï¼‰
market_data = client.get_market_data('BTC/USDT')

if market_data:
    print(f"æ•°æ®æº: {market_data['source']}")  # 'hyperliquid' æˆ– 'binance'
    print(f"èµ„é‡‘è´¹ç‡: {market_data['funding_rate']:.4%}")
    print(f"æŒä»“é‡: ${market_data['open_interest']:,.2f}")
    print(f"ä»·æ ¼: ${market_data['price']:,.2f}")
```

### 4. æŸ¥çœ‹æ•°æ®æºç»Ÿè®¡

```python
# æŸ¥çœ‹æ¯ä¸ªäº¤æ˜“å¯¹ä½¿ç”¨çš„æ•°æ®æº
for symbol, source in client.data_source.items():
    print(f"{symbol} -> {source}")
```

---

## å®ç°ç»†èŠ‚

### æ–‡ä»¶ç»“æ„

```
utils/
â”œâ”€â”€ hyperliquid_client.py      # ä¸»å®¢æˆ·ç«¯ï¼ˆå¤šæ•°æ®æºæ”¯æŒï¼‰
â”œâ”€â”€ binance_data_client.py     # Binanceæ•°æ®å®¢æˆ·ç«¯
â”œâ”€â”€ data_persistence.py         # æ•°æ®æŒä¹…åŒ–æ¨¡å—
â””â”€â”€ ...
```

### æ ¸å¿ƒç±»

#### 1. HyperliquidClient (ä¸»å®¢æˆ·ç«¯)

**æ–‡ä»¶**: [utils/hyperliquid_client.py](utils/hyperliquid_client.py:24-86)

**åŠŸèƒ½**ï¼š
- å¤šæ•°æ®æºç®¡ç†
- è‡ªåŠ¨å›é€€é€»è¾‘
- æ•°æ®æŒä¹…åŒ–é›†æˆ
- æ•°æ®æºæ ‡è®°

**å…³é”®æ–¹æ³•**ï¼š

```python
def get_market_data(self, symbol: str) -> Optional[Dict]:
    """
    è·å–å¸‚åœºæ•°æ®ï¼ˆè‡ªåŠ¨é€‰æ‹©æ•°æ®æºï¼‰

    æµç¨‹ï¼š
    1. å°è¯•ä»Hyperliquidè·å–
    2. å¦‚æœå¤±è´¥ï¼Œå›é€€åˆ°Binance
    3. è®°å½•ä½¿ç”¨çš„æ•°æ®æº
    4. è¿”å›ç»Ÿä¸€æ ¼å¼çš„æ•°æ®
    """
```

#### 2. BinanceDataClient (å¤‡ç”¨æ•°æ®æº)

**æ–‡ä»¶**: [utils/binance_data_client.py](utils/binance_data_client.py)

**åŠŸèƒ½**ï¼š
- ä»Binance Futures APIè·å–æ•°æ®
- èµ„é‡‘è´¹ç‡ã€æŒä»“é‡ã€æ ‡è®°ä»·æ ¼
- ä¸Hyperliquidç›¸åŒçš„æ•°æ®æ ¼å¼

**APIç«¯ç‚¹**ï¼š
- `/fapi/v1/premiumIndex` - èµ„é‡‘è´¹ç‡å’Œæ ‡è®°ä»·æ ¼
- `/fapi/v1/openInterest` - æŒä»“é‡

### æ•°æ®æ ¼å¼

ä¸¤ä¸ªæ•°æ®æºè¿”å›ç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼š

```python
{
    'funding_rate': 0.0013,        # èµ„é‡‘è´¹ç‡ï¼ˆå°æ•°å½¢å¼ï¼‰
    'open_interest': 31005.31,     # æŒä»“é‡ï¼ˆUSDTè®¡ä»·ï¼‰
    'price': 115264.0,             # æ ‡è®°ä»·æ ¼
    'timestamp': 1761663893.387,   # æ—¶é—´æˆ³
    'source': 'hyperliquid'        # æ•°æ®æºæ ‡è®°
}
```

---

## æ•°æ®æºå¯¹æ¯”

### Hyperliquid vs Binance

| ç‰¹æ€§ | Hyperliquid | Binance |
|-----|-------------|---------|
| **è¦†ç›–èŒƒå›´** | 218+ äº¤æ˜“å¯¹ | 200+ äº¤æ˜“å¯¹ |
| **æ•°æ®è´¨é‡** | é«˜ï¼ˆå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼‰ | é«˜ï¼ˆå…¨çƒæœ€å¤§äº¤æ˜“æ‰€ï¼‰ |
| **APIå»¶è¿Ÿ** | ~1ç§’ | ~1ç§’ |
| **è´¹ç‡æ›´æ–°** | æ¯8å°æ—¶ | æ¯8å°æ—¶ |
| **æŒä»“é‡å•ä½** | USDTè®¡ä»· | å¸æœ¬ä½ï¼ˆéœ€è½¬æ¢ï¼‰ |
| **APIé™åˆ¶** | è¾ƒå®½æ¾ | è¾ƒä¸¥æ ¼ï¼ˆ1200æ¬¡/åˆ†é’Ÿï¼‰ |
| **ä¼˜å…ˆçº§** | ğŸ¥‡ ä¼˜å…ˆä½¿ç”¨ | ğŸ¥ˆ å¤‡ç”¨æ•°æ®æº |

### ä¸ºä»€ä¹ˆä¼˜å…ˆä½¿ç”¨Hyperliquidï¼Ÿ

1. **å»ä¸­å¿ƒåŒ–** - æ•°æ®æ›´é€æ˜ï¼Œä¸å—å•ä¸€äº¤æ˜“æ‰€æ§åˆ¶
2. **èªæ˜é’±åŒ…æ•°æ®** - æ”¯æŒè¿½è¸ªå¤§æˆ·è¡Œä¸ºï¼ˆæœªæ¥åŠŸèƒ½ï¼‰
3. **OIæ•°æ®ç›´æ¥** - USDTè®¡ä»·ï¼Œæ— éœ€è½¬æ¢
4. **APIç¨³å®š** - é™åˆ¶è¾ƒå®½æ¾ï¼Œé€‚åˆé«˜é¢‘è°ƒç”¨

### ä½•æ—¶ä½¿ç”¨Binanceï¼Ÿ

1. Hyperliquidä¸æ”¯æŒçš„äº¤æ˜“å¯¹
2. Hyperliquid APIæš‚æ—¶ä¸å¯ç”¨
3. éœ€è¦æ›´å¤šå†å²æ•°æ®ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šHyperliquidæ”¯æŒçš„äº¤æ˜“å¯¹

```bash
python3 test_multi_source.py
```

**ç»“æœ**ï¼š
```
æµ‹è¯• BTC/USDT:
  âœ… æ•°æ®è·å–æˆåŠŸ
  ğŸ“Š æ•°æ®æº: hyperliquid
  ğŸ’° èµ„é‡‘è´¹ç‡: 0.0013%
  ğŸ“ˆ æŒä»“é‡: $31,005.31
  ğŸ’µ ä»·æ ¼: $115,264.00
```

### æµ‹è¯•2ï¼šBinanceå¤‡ç”¨æ•°æ®æº

```bash
python3 test_binance_fallback.py
```

**ç»“æœ**ï¼š
```
æµ‹è¯• BTC/USDT:
  âœ… æ•°æ®è·å–æˆåŠŸ
  ğŸ’° èµ„é‡‘è´¹ç‡: 0.0033%
  ğŸ“ˆ æŒä»“é‡: $8,981,964,420.38
  ğŸ’µ ä»·æ ¼: $115,209.20
```

### æµ‹è¯•3ï¼šæ•°æ®æºç»Ÿè®¡

```python
from utils.hyperliquid_client import HyperliquidClient

client = HyperliquidClient()

# æµ‹è¯•å¤šä¸ªäº¤æ˜“å¯¹
for symbol in ['BTC/USDT', 'ETH/USDT', 'SOL/USDT', 'DOGE/USDT']:
    client.get_market_data(symbol)

# æŸ¥çœ‹æ•°æ®æºä½¿ç”¨æƒ…å†µ
print(client.data_source)
# è¾“å‡º: {'BTC/USDT': 'hyperliquid', 'ETH/USDT': 'hyperliquid', ...}
```

---

## é”™è¯¯å¤„ç†

### åœºæ™¯1ï¼šHyperliquidä¸æ”¯æŒè¯¥äº¤æ˜“å¯¹

```
INFO - ğŸ”„ XYZ/USDT åœ¨Hyperliquidä¸å¯ç”¨ï¼Œåˆ‡æ¢åˆ°Binance
INFO - âœ… XYZ/USDT ä½¿ç”¨Binanceæ•°æ®
```

**è¡Œä¸º**ï¼šè‡ªåŠ¨åˆ‡æ¢åˆ°Binanceï¼Œé€æ˜å¤„ç†

### åœºæ™¯2ï¼šBinanceä¹Ÿä¸æ”¯æŒ

```
ERROR - âŒ XYZ/USDT æ— æ³•ä»ä»»ä½•æ•°æ®æºè·å–å¸‚åœºæ•°æ®
```

**è¡Œä¸º**ï¼šè¿”å›Noneï¼Œç­–ç•¥å¼•æ“è·³è¿‡è¯¥äº¤æ˜“å¯¹

### åœºæ™¯3ï¼šç½‘ç»œé”™è¯¯

```
WARNING - âš ï¸  Hyperliquid APIè°ƒç”¨å¤±è´¥: Connection timeout
INFO - ğŸ”„ åˆ‡æ¢åˆ°Binance
```

**è¡Œä¸º**ï¼šè‡ªåŠ¨é‡è¯•å¤‡ç”¨æ•°æ®æº

---

## é…ç½®é€‰é¡¹

### HyperliquidClient å‚æ•°

```python
HyperliquidClient(
    base_url="https://api.hyperliquid.xyz",  # Hyperliquid APIåœ°å€
    enable_persistence=True,                  # å¯ç”¨æ•°æ®æŒä¹…åŒ–
    enable_binance_fallback=True             # å¯ç”¨Binanceå¤‡ç”¨æ•°æ®æº
)
```

### ç¦ç”¨Binanceå›é€€

å¦‚æœåªæƒ³ä½¿ç”¨Hyperliquidï¼š

```python
client = HyperliquidClient(enable_binance_fallback=False)
```

### æ•°æ®æŒä¹…åŒ–

æ•°æ®æŒä¹…åŒ–å¯¹ä¸¤ä¸ªæ•°æ®æºéƒ½ç”Ÿæ•ˆï¼š

```python
# æ•°æ®ä¿å­˜åœ¨ data/persistence/
# - oi_history.json
# - funding_rate_history.json

# æ ¼å¼ç¤ºä¾‹
{
  "saved_at": 1761663893.954,
  "data": {
    "BTC/USDT": [
      {
        "timestamp": 1761663893.387,
        "oi": 31013.46,
        "price": 115265.0,
        "source": "hyperliquid"  # è®°å½•æ•°æ®æº
      }
    ]
  }
}
```

---

## æ€§èƒ½è€ƒè™‘

### APIè°ƒç”¨æ¬¡æ•°

**å•æ¬¡è·å–å¸‚åœºæ•°æ®**ï¼š
- HyperliquidæˆåŠŸï¼š1æ¬¡APIè°ƒç”¨
- Hyperliquidå¤±è´¥ + BinanceæˆåŠŸï¼š2æ¬¡APIè°ƒç”¨ï¼ˆ1æ¬¡Hyperliquid + 1æ¬¡Binanceï¼‰

**Binance APIé™åˆ¶**ï¼š
- 1200æ¬¡/åˆ†é’Ÿï¼ˆå¯¹äº`get_market_data`ï¼Œå®é™…æ˜¯3æ¬¡å­è°ƒç”¨/æ¬¡ï¼‰
- å»ºè®®è°ƒç”¨é¢‘ç‡ï¼š<200æ¬¡/åˆ†é’Ÿï¼ˆç•™æœ‰ä½™é‡ï¼‰

### ç¼“å­˜ç­–ç•¥

æ•°æ®æŒä¹…åŒ–æä¾›äº†éšå¼ç¼“å­˜ï¼š
- å†å²æ•°æ®ä¿å­˜24å°æ—¶
- é‡å¯åè‡ªåŠ¨åŠ è½½
- é¿å…é‡å¤APIè°ƒç”¨

---

## é›†æˆåˆ°ç­–ç•¥å¼•æ“

StrategyEngineå·²è‡ªåŠ¨é›†æˆå¤šæ•°æ®æºæ”¯æŒï¼š

```python
# strategy_engine.py ä¸­çš„ä»£ç 
self.hyperliquid = HyperliquidClient(
    enable_persistence=True,
    enable_binance_fallback=True  # è‡ªåŠ¨å¯ç”¨
)

# è·å–å¸‚åœºæ•°æ®æ—¶è‡ªåŠ¨é€‰æ‹©æ•°æ®æº
adjustment, description = self.hyperliquid.get_funding_signal(symbol)
```

**æ— éœ€ä¿®æ”¹ç­–ç•¥ä»£ç ** - å¤šæ•°æ®æºæ”¯æŒæ˜¯é€æ˜çš„ã€‚

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•çŸ¥é“æŸä¸ªäº¤æ˜“å¯¹ä½¿ç”¨äº†å“ªä¸ªæ•°æ®æºï¼Ÿ

**A**: æŸ¥çœ‹æ—¥å¿—æˆ–`client.data_source`å­—å…¸ï¼š

```python
client = HyperliquidClient()
market_data = client.get_market_data('BTC/USDT')
print(f"æ•°æ®æº: {market_data['source']}")  # æˆ–
print(f"æ•°æ®æº: {client.data_source['BTC/USDT']}")
```

### Q2: Hyperliquidå’ŒBinanceçš„æ•°æ®ä¼šæœ‰å·®å¼‚å—ï¼Ÿ

**A**: ä¼šæœ‰è½»å¾®å·®å¼‚ï¼ˆé€šå¸¸<0.01%ï¼‰ï¼ŒåŸå› ï¼š
- ä¸¤ä¸ªäº¤æ˜“æ‰€çš„å¸‚åœºç‹¬ç«‹
- èµ„é‡‘è´¹ç‡è®¡ç®—æ–¹å¼ç•¥æœ‰ä¸åŒ
- æŒä»“é‡ç»Ÿè®¡èŒƒå›´ä¸åŒ

**å»ºè®®**: ä¼˜å…ˆä½¿ç”¨Hyperliquidä¿æŒä¸€è‡´æ€§ã€‚

### Q3: å¦‚ä½•æ·»åŠ æ–°çš„äº¤æ˜“å¯¹ï¼Ÿ

**A**: åœ¨`config/strategy_params.py`ä¸­æ·»åŠ ï¼š

```python
TRADING_SYMBOLS = [
    'BTC/USDT',
    'ETH/USDT',
    'SOL/USDT',
    'YOUR/USDT',  # æ·»åŠ ä½ çš„äº¤æ˜“å¯¹
]
```

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©å¯ç”¨çš„æ•°æ®æºã€‚

### Q4: å¦‚ä½•æ·»åŠ ç¬¬ä¸‰ä¸ªæ•°æ®æºï¼Ÿ

**A**: å‚è€ƒ`BinanceDataClient`å®ç°æ–°çš„æ•°æ®æºç±»ï¼š

```python
class NewExchangeClient:
    def get_market_data(self, symbol: str) -> Optional[Dict]:
        # è¿”å›ç»Ÿä¸€æ ¼å¼çš„æ•°æ®
        return {
            'funding_rate': ...,
            'open_interest': ...,
            'price': ...,
            'timestamp': time.time()
        }
```

ç„¶ååœ¨`HyperliquidClient`ä¸­æ·»åŠ ç¬¬ä¸‰çº§å›é€€é€»è¾‘ã€‚

---

## æœªæ¥æ”¹è¿›

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **æ™ºèƒ½æ•°æ®æºé€‰æ‹©**
   - æ ¹æ®APIå»¶è¿ŸåŠ¨æ€é€‰æ‹©
   - æ ¹æ®æ•°æ®è´¨é‡è¯„åˆ†é€‰æ‹©
   - è´Ÿè½½å‡è¡¡

2. **å¤šæ•°æ®æºèšåˆ**
   - åŒæ—¶è·å–å¤šä¸ªæ•°æ®æº
   - è®¡ç®—åŠ æƒå¹³å‡
   - å¼‚å¸¸å€¼æ£€æµ‹

3. **æ›´å¤šæ•°æ®æº**
   - OKX
   - Bybit
   - Gate.io

4. **æ•°æ®æºå¥åº·ç›‘æ§**
   - APIå¯ç”¨æ€§æ£€æµ‹
   - å»¶è¿Ÿç›‘æ§
   - è‡ªåŠ¨é™çº§

---

## æ€»ç»“

### âœ… å·²å®ç°

1. âœ… å¤šæ•°æ®æºæ¶æ„ï¼ˆHyperliquid + Binanceï¼‰
2. âœ… è‡ªåŠ¨å›é€€é€»è¾‘
3. âœ… ç”¨æˆ·è‡ªå®šä¹‰äº¤æ˜“å¯¹é…ç½®
4. âœ… æ•°æ®æºæ ‡è®°å’Œç»Ÿè®¡
5. âœ… ç»Ÿä¸€çš„æ•°æ®æ ¼å¼
6. âœ… æ•°æ®æŒä¹…åŒ–é›†æˆ
7. âœ… å®Œæ•´çš„æµ‹è¯•éªŒè¯

### ğŸ¯ å…³é”®ä¼˜åŠ¿

1. **çµæ´»æ€§** - æ”¯æŒä»»æ„äº¤æ˜“å¯¹ç»„åˆ
2. **å¯é æ€§** - è‡ªåŠ¨å›é€€ä¿è¯å¯ç”¨æ€§
3. **é€æ˜æ€§** - æ•°æ®æºå¯è¿½è¸ª
4. **æ˜“ç”¨æ€§** - é›¶é…ç½®è‡ªåŠ¨åˆ‡æ¢
5. **æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°æ•°æ®æº

### ğŸ“Š å®é™…æ•ˆæœ

- **äº¤æ˜“å¯¹è¦†ç›–**: 400+ (Hyperliquid 218+ + Binance 200+)
- **æ•°æ®å¯ç”¨æ€§**: >99% (åŒæ•°æ®æºå†—ä½™)
- **APIè°ƒç”¨ä¼˜åŒ–**: ä¼˜å…ˆä½¿ç”¨Hyperliquidï¼ˆé™åˆ¶å®½æ¾ï¼‰
- **ç”¨æˆ·ä½“éªŒ**: å®Œå…¨é€æ˜ï¼Œæ— éœ€é…ç½®

---

**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®ä½ çš„äº¤æ˜“éœ€æ±‚ï¼Œåœ¨`TRADING_SYMBOLS`ä¸­é…ç½®äº¤æ˜“å¯¹åˆ—è¡¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ•°æ®æºé€‰æ‹©ï¼
