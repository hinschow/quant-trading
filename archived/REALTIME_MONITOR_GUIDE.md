# 📡 实时交易信号监控系统使用指南

## 🎯 功能介绍

这是一个基于 WebSocket 的**实时交易信号监控系统**，可以：

- ✅ **实时接收**交易所K线数据（WebSocket 或轮询）
- ✅ **动态计算**技术指标（EMA, RSI, MACD, ADX, BBW）
- ✅ **实时生成**买卖信号
- ✅ **信号变化提醒**（当操作建议改变时立即通知）
- ✅ **美观的终端显示**（实时单行更新）
- ✅ **多时间周期支持**（1m, 5m, 15m, 1h, 4h, 1d）

---

## 🚀 快速开始

### 1. 安装依赖

```bash
# 进入项目目录
cd /Volumes/datedisk/code/quant-trading
source venv/bin/activate

# 安装 ccxt.pro（WebSocket 支持）
pip install 'ccxt.pro>=4.0.0,<4.3.0'
```

### 2. 运行实时监控

```bash
# 监听 BTC/USDT 1小时K线
python realtime_monitor.py BTC/USDT -t 1h --proxy http://127.0.0.1:7890

# 监听 ETH/USDT 15分钟K线（短线）
python realtime_monitor.py ETH/USDT -t 15m --proxy http://127.0.0.1:7890

# 监听 SOL/USDT 4小时K线（中线）
python realtime_monitor.py SOL/USDT -t 4h --proxy http://127.0.0.1:7890
```

---

## 📊 界面说明

### 启动时的输出

```
================================================================================
🚀 实时交易信号监控
================================================================================
交易对: BTC/USDT
周期: 1h
交易所: binance
代理: http://127.0.0.1:7890
================================================================================

📥 正在获取历史数据...
⚙️  正在初始化信号引擎...

================================================================================
📊 初始信号
================================================================================

【市场状态】
  ↔️  震荡
  策略: MEAN_REVERSION

【价格信息】
  当前价格: $110,271.48
  EMA50:    $109,965.28
  EMA200:   $113,041.90

【技术指标】
  RSI:  53.7
  MACD: 351.33
  ADX:  14.8
  BBW:  0.0550

【交易信号】
  ⚪ 操作: HOLD
  强度: 0/100 ░░░░░░░░░░

  理由:
    • 无明确信号

【建议】
  ⚪ 观望

================================================================================

📡 开始实时监听...
================================================================================
```

### 实时状态行

程序运行时，会显示一行实时更新的状态：

```
16:30:45 | 价格: $110,345.23 | ↔️ RANGE       | ⚪ HOLD | 强度:   0/100 | K线:    15 | 信号变化: 0
```

状态行包含：
- 时间
- 当前价格
- 市场状态
- 操作建议
- 信号强度
- 接收K线数量
- 信号变化次数

### 信号变化提醒

当买卖信号改变时（如从 HOLD → BUY），会显示完整的信号详情：

```
================================================================================
🔔 信号变化！(2025-10-24 16:45:30)
================================================================================

【市场状态】
  🔥 强趋势
  策略: TREND_FOLLOWING

【价格信息】
  当前价格: $111,234.56
  EMA50:    $110,123.45
  EMA200:   $109,567.89

【技术指标】
  RSI:  62.3
  MACD: 456.78
  ADX:  35.2
  BBW:  0.0892

【交易信号】
  🟢 操作: BUY
  强度: 75/100 ███████░░░

  理由:
    • EMA金叉(50上穿200)
    • MACD金叉
    • ADX强趋势(35.2)

【建议】
  ✅ 考虑买入
  📍 入场: $111,234.56
  🛡️ 止损: $107,897.52 (-3%)
  🎯 目标: $116,796.29 (+5%)

================================================================================
```

---

## 🎛️ 命令参数

```bash
python realtime_monitor.py <交易对> [选项]
```

### 必需参数

- `symbol` - 交易对，如 `BTC/USDT`, `ETH/USDT`

### 可选参数

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `-t, --timeframe` | 时间周期 | `1h` | `-t 15m` |
| `-e, --exchange` | 交易所 | `binance` | `-e okx` |
| `--proxy` | 代理地址 | 无 | `--proxy http://127.0.0.1:7890` |

### 支持的时间周期

- `1m` - 1分钟（超短线，频繁更新）
- `5m` - 5分钟（短线）
- `15m` - 15分钟（短线）
- `1h` - 1小时（默认，中短线）
- `4h` - 4小时（中线）
- `1d` - 日线（长线）

---

## 💡 使用场景

### 场景 1：超短线交易（15分钟）

```bash
# 监听15分钟K线，快速捕捉短期波动
python realtime_monitor.py BTC/USDT -t 15m --proxy http://127.0.0.1:7890
```

**适合：**
- 日内交易者
- 追求快速进出
- 时刻盯盘

**注意：**
- 信号变化频繁
- 需要快速反应
- 建议设置严格止损

### 场景 2：中短线交易（1小时）

```bash
# 监听1小时K线，平衡频率和可靠性
python realtime_monitor.py BTC/USDT -t 1h --proxy http://127.0.0.1:7890
```

**适合：**
- 兼职交易者
- 不能时刻盯盘
- 追求稳定收益

**优点：**
- 信号相对可靠
- 更新频率适中
- 容易把握

### 场景 3：中线交易（4小时）

```bash
# 监听4小时K线，捕捉中期趋势
python realtime_monitor.py BTC/USDT -t 4h --proxy http://127.0.0.1:7890
```

**适合：**
- 波段交易者
- 追踪中期趋势
- 降低交易频率

**优点：**
- 过滤短期噪音
- 趋势更明确
- 持仓时间更长

### 场景 4：监控多个币种

在不同终端窗口运行多个监控器：

```bash
# 终端 1 - 监控 BTC
python realtime_monitor.py BTC/USDT -t 1h --proxy http://127.0.0.1:7890

# 终端 2 - 监控 ETH
python realtime_monitor.py ETH/USDT -t 1h --proxy http://127.0.0.1:7890

# 终端 3 - 监控 SOL
python realtime_monitor.py SOL/USDT -t 1h --proxy http://127.0.0.1:7890
```

或使用 tmux 分屏：

```bash
# 安装 tmux
brew install tmux

# 创建会话
tmux new -s trading

# 分屏（Ctrl-B 然后按 %）
# 在每个窗口运行不同的监控器
```

---

## 🔧 高级用法

### 1. 后台运行

```bash
# 使用 nohup 后台运行
nohup python realtime_monitor.py BTC/USDT -t 1h --proxy http://127.0.0.1:7890 > btc_monitor.log 2>&1 &

# 查看日志
tail -f btc_monitor.log

# 停止后台进程
ps aux | grep realtime_monitor
kill <PID>
```

### 2. 创建启动脚本

```bash
cat > start_monitor.sh << 'EOF'
#!/bin/bash

PROXY="http://127.0.0.1:7890"

# 启动多个监控器
python realtime_monitor.py BTC/USDT -t 1h --proxy $PROXY > logs/btc_1h.log 2>&1 &
python realtime_monitor.py ETH/USDT -t 1h --proxy $PROXY > logs/eth_1h.log 2>&1 &
python realtime_monitor.py SOL/USDT -t 1h --proxy $PROXY > logs/sol_1h.log 2>&1 &

echo "✅ 监控器已启动"
echo "查看日志: tail -f logs/btc_1h.log"
EOF

chmod +x start_monitor.sh
mkdir -p logs
./start_monitor.sh
```

### 3. 系统通知（macOS）

修改代码添加通知功能：

```python
# 在 realtime_monitor.py 的 on_signal_change 方法中添加
import subprocess

def on_signal_change(self, signal: Dict):
    """信号变化回调"""
    self.signal_changes += 1

    # ... 现有代码 ...

    # macOS 通知
    action = signal['action']
    strength = signal['strength']

    if action in ['BUY', 'SELL'] and strength >= 60:
        title = f"{self.symbol} 交易信号"
        message = f"{action} 信号强度: {strength}/100"
        subprocess.run([
            'osascript', '-e',
            f'display notification "{message}" with title "{title}"'
        ])
```

---

## 📊 信号解读

### 市场状态

| 状态 | 图标 | 说明 | 推荐策略 |
|------|------|------|----------|
| STRONG_TREND | 🔥 | 强趋势（高ADX+高波动） | 趋势跟随 |
| TREND | 📈 | 趋势（中等ADX） | 趋势跟随 |
| RANGE | ↔️ | 震荡（低ADX+低波动） | 均值回归 |
| SQUEEZE | 💥 | 挤压（波动极低） | 等待突破 |
| NEUTRAL | 😐 | 中性 | 观望 |

### 操作建议

| 操作 | 图标 | 信号强度 | 说明 |
|------|------|----------|------|
| BUY | 🟢 | 60-100 | 考虑买入 |
| SELL | 🔴 | 60-100 | 考虑卖出 |
| HOLD | ⚪ | 0-59 | 观望等待 |

### 建议操作

**强买入信号（BUY, 强度 ≥ 70）：**
- ✅ 可以考虑建仓
- 📍 按建议价格入场
- 🛡️ 设置止损（建议-3%）
- 🎯 设置目标（建议+5%）

**中等信号（强度 40-69）：**
- ⚠️ 谨慎对待
- 💡 等待更强信号
- 🔍 结合其他时间周期确认

**弱信号/观望（强度 < 40）：**
- ⚪ 暂不操作
- 👀 继续观察
- ⏰ 等待机会

---

## ⚠️ 重要提醒

1. **这是辅助工具，不是投资建议**
   - 所有信号仅供参考
   - 需要结合你的判断
   - 风险自负

2. **网络要求**
   - WebSocket 需要稳定网络
   - 建议使用代理（如果必要）
   - 连接中断会自动重连

3. **资源消耗**
   - 实时监控会持续占用CPU
   - 建议不要同时运行太多监控器
   - 长时间运行建议后台执行

4. **数据延迟**
   - WebSocket 模式：几乎实时
   - 轮询模式：有一定延迟（取决于时间周期）
   - 价格波动剧烈时注意滑点

5. **风险管理**
   - 永远设置止损
   - 控制仓位大小
   - 不要过度交易
   - 记录每笔交易

---

## 🐛 故障排除

### 问题 1：无法连接 WebSocket

```
❌ WebSocket 错误: ...
```

**解决：**
```bash
# 方法1：使用代理
python realtime_monitor.py BTC/USDT --proxy http://127.0.0.1:7890

# 方法2：切换到轮询模式（会自动降级）
# 程序会自动检测并使用轮询模式
```

### 问题 2：ccxt.pro 未安装

```
ModuleNotFoundError: No module named 'ccxt.pro'
```

**解决：**
```bash
pip install 'ccxt.pro>=4.0.0,<4.3.0'
```

### 问题 3：数据不足

```
⏳ 数据不足: 50/200
```

**原因：**
- 刚启动时需要时间积累数据
- 至少需要200条K线才能计算指标

**解决：**
- 等待几分钟（取决于时间周期）
- 或者程序会自动加载历史数据

### 问题 4：信号始终是 HOLD

**原因：**
- 当前市场确实没有明确信号
- 可能处于震荡或挤压状态

**建议：**
- 耐心等待
- 尝试其他时间周期
- 扫描其他币种

---

## 📈 对比：批量分析 vs 实时监控

| 特性 | 批量分析 (signal_analyzer.py) | 实时监控 (realtime_monitor.py) |
|------|-------------------------------|--------------------------------|
| **数据获取** | 一次性获取历史数据 | 持续接收实时数据 |
| **更新频率** | 手动运行 | 自动更新（实时） |
| **适用场景** | 盘前分析、批量筛选 | 盘中监控、及时捕捉 |
| **资源消耗** | 低（执行完即结束） | 中（持续运行） |
| **信号提醒** | 无 | 有（信号变化时） |
| **多币种** | 支持批量扫描 | 需要多个进程 |

**建议：**
- 盘前：使用批量分析筛选机会
- 盘中：使用实时监控追踪信号
- 结合使用效果最佳

---

## 🎓 最佳实践

### 1. 多周期确认

不要只看单个时间周期，建议：

```bash
# 终端1：查看日线大趋势
python realtime_monitor.py BTC/USDT -t 1d --proxy http://127.0.0.1:7890

# 终端2：查看4小时中期走势
python realtime_monitor.py BTC/USDT -t 4h --proxy http://127.0.0.1:7890

# 终端3：查看1小时寻找入场点
python realtime_monitor.py BTC/USDT -t 1h --proxy http://127.0.0.1:7890
```

### 2. 设置价格提醒

当处于 SQUEEZE（挤压）状态时：
- 📌 记录当前价格
- 🔔 设置突破价格提醒
- 💥 等待大行情爆发

### 3. 记录交易

创建交易日志：

```bash
# 当信号出现时，记录到文件
echo "$(date) | BTC/USDT | BUY | 价格: 111234.56 | 强度: 75" >> trading_log.txt
```

### 4. 定期复盘

- 📊 每周检查信号准确率
- 📈 统计盈亏情况
- 🔧 调整策略参数

---

## 🚀 下一步增强

**已计划的功能：**
- [ ] Telegram 机器人通知
- [ ] 邮件提醒
- [ ] Web 界面
- [ ] 多币种聚合监控
- [ ] 信号回测验证
- [ ] 自动下单（谨慎！）

---

## 📞 需要帮助？

查看其他文档：
- [SIGNAL_ANALYZER_GUIDE.md](SIGNAL_ANALYZER_GUIDE.md) - 批量分析工具
- [NETWORK_TROUBLESHOOTING.md](NETWORK_TROUBLESHOOTING.md) - 网络问题排查
- [README.md](README.md) - 项目总览

---

祝交易顺利！📈💰

记住：**永远不要投入超过你能承受损失的资金！**
