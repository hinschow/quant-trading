# 数字货币量化交易系统 v7.2

**Stage2.2**: 量价背离分级 + Hyperliquid资金费率 + 聪明钱包追踪 + 多数据源支持

基于趋势跟踪策略，集成多个市场情绪指标，支持Hyperliquid和Binance双数据源。

---

## 🎯 核心特性

### 1. 智能信号生成
- ✅ **趋势跟踪**：EMA、MACD、ADX组合
- ✅ **量价背离分级**：4级惩罚系统（-30/-20/-10/-5分）
- ✅ **资金费率调整**：Hyperliquid实时费率（-15~+15分）
- ✅ **聪明钱包追踪**：OI变化追踪大户行为（-20~+20分）
- ✅ **动态阈值**：根据市场状态自适应

### 2. 多数据源支持
- 🟦 **Hyperliquid优先**：218+交易对，去中心化数据
- 🟨 **Binance备用**：200+交易对，全球最大交易所
- 🔄 **自动切换**：Hyperliquid不可用时自动回退到Binance
- 💾 **数据持久化**：24小时滚动窗口，支持连续运行

### 3. 完整回测系统
- 📊 多周期回测（15m/30m/1h）
- 📈 逐笔交易记录
- 📉 性能指标分析
- 🎯 参数优化支持

---

## 📁 项目结构

```
quant-trading/
├── 📄 README.md                          本文档
├── 📄 如何配置交易对.md                  配置指南（⭐必读）
├── 📄 多数据源支持文档.md                技术文档
├── 📄 Stage2.2_完成总结.md              版本总结
├── 📄 项目结构.md                        详细结构说明
│
├── 🐍 strategy_engine.py                 策略引擎（信号生成）
├── 🐍 backtest_engine.py                 回测引擎
├── 🐍 realtime_engine.py                 实时交易引擎
├── 🐍 data_collector.py                  数据收集器
├── 🐍 websocket_stream.py                WebSocket数据流
├── 🐍 run_multi_timeframe_backtest.py    多周期回测脚本
│
├── ⚙️ config/                            配置文件夹
│   ├── strategy_params.py               策略参数（v7.2）
│   └── storage_params.py                存储参数
│
├── 🛠️ utils/                             工具模块
│   ├── indicators.py                    技术指标
│   ├── hyperliquid_client.py            多数据源客户端
│   ├── binance_data_client.py           Binance客户端
│   ├── data_persistence.py              数据持久化
│   ├── market_sentiment.py              市场情绪
│   ├── exchange_info.py                 交易所信息
│   └── data_buffer.py                   数据缓冲
│
├── 💾 data/                              数据文件夹
│   └── persistence/                     持久化数据
│
├── 📊 backtest_results/                  回测结果
│   └── multi_timeframe/30m/             最新结果（Stage2）
│
└── 📦 archived/                          归档文件夹
```

---

## 🚀 快速开始

### 1. 配置交易对

编辑 `config/strategy_params.py`：

```python
# 配置你想交易的交易对
TRADING_SYMBOLS = [
    'BTC/USDT',
    'ETH/USDT',
    'SOL/USDT',
    # 添加更多交易对...
]
```

**详细说明**: 查看 [如何配置交易对.md](如何配置交易对.md)

### 2. 运行回测

```bash
# 多周期回测（测试最优周期）
python3 run_multi_timeframe_backtest.py

# 查看结果
ls -lh backtest_results/multi_timeframe/
```

### 3. 查看数据源

```python
from utils.hyperliquid_client import HyperliquidClient

client = HyperliquidClient()

# 测试交易对数据获取
market_data = client.get_market_data('BTC/USDT')
print(f"数据源: {market_data['source']}")  # hyperliquid 或 binance
```

---

## 📊 Stage2.2 回测结果

**时间范围**: 2025-10-13 ~ 2025-10-27 (30分钟周期)

| 品种 | 交易数 | 收益率 | 胜率 | 盈亏比 | 最大回撤 |
|-----|--------|--------|------|--------|----------|
| BTC | 4笔 | -0.43% | 50% | 4.57 | -2.02% |
| ETH | 5笔 | -5.02% | 40% | 0.65 | -6.06% |
| SOL | 5笔 | +8.49% | 60% | 1.96 | -1.30% |
| **总计** | **14笔** | **+3.04%** | **50%** | **1.47** | **-2.85%** |

**核心改进**（vs Stage1）:
- ✅ BTC性能提升：-3.37% → -0.43% (+2.95%)
- ✅ 新增交易质量高（100%盈利率）
- ✅ 量价背离分级系统按预期工作

---

## 🎯 策略说明

### 信号强度计算

```
基础分数（趋势+技术指标）
    ↓
- 量价背离惩罚（-30/-20/-10/-5分）
    ↓
+ 资金费率调整（-15~+15分）
    ↓
+ 聪明钱包追踪（-20~+20分）
    ↓
最终信号强度 ≥ 40分 → 买入
```

### 量价背离分级

| 背离程度 | OBV差距 | 惩罚 | 含义 |
|---------|---------|------|------|
| 严重背离 | >10% | -30分 | 强烈看空信号 |
| 中度背离 | 5-10% | -20分 | 中等看空 |
| 轻微背离 | 2-5% | -10分 | 轻度看空 |
| 微弱背离 | ≤2% | -5分 | 略微看空 |

### 资金费率调整

| 费率范围 | 调整 | 市场情绪 |
|---------|------|----------|
| >1.5% | -15分 | 极度贪婪 |
| >1.0% | -10分 | 贪婪 |
| >0.5% | -5分 | 偏热 |
| -0.5~0.5% | 0分 | 正常 |
| <-0.5% | +5分 | 偏冷 |
| <-1.0% | +10分 | 恐慌 |
| <-1.5% | +15分 | 极度恐慌 |

### 聪明钱包追踪

| OI变化 | 价格变化 | 调整 | 含义 |
|--------|---------|------|------|
| ↑>5% | ↑>2% | +20分 | 大户做多 |
| ↑>5% | ↓>2% | -20分 | 大户做空 |
| ↓>3% | ↑>2% | -10分 | 获利了结 |
| ↓>3% | ↓>2% | +5分 | 止损离场 |

---

## 📖 文档

- **[如何配置交易对.md](如何配置交易对.md)** - 快速配置指南（必读）
- **[多数据源支持文档.md](多数据源支持文档.md)** - 技术实现详解
- **[Stage2.2_完成总结.md](Stage2.2_完成总结.md)** - 完整版本总结
- **[项目结构.md](项目结构.md)** - 详细文件结构

---

## 🔧 技术栈

- **语言**: Python 3.10+
- **数据源**: Hyperliquid API + Binance Futures API
- **技术指标**: TA-Lib, pandas, numpy
- **数据持久化**: JSON (轻量级)
- **回测引擎**: 自研逐笔回测

---

## ⚠️ 注意事项

### 数据源选择
- 系统会**优先使用Hyperliquid**（去中心化，支持聪明钱包追踪）
- 如果Hyperliquid不支持该交易对，**自动切换到Binance**
- 你只需要配置交易对列表，数据源切换完全自动

### 实盘交易
- Stage2.2集成的资金费率和聪明钱包追踪**无法回测**（只有实时数据）
- 建议**小资金实盘验证**（$1000-2000，SOL单币种，2周）
- 监控实盘效果后再决定是否扩大规模

### 风险控制
- 单笔止损：2.5-3%
- 单笔止盈：4.5-5%
- 建议起始资金：$5000+
- 最大回撤警戒线：15%

---

## 🛠️ 开发计划

### 已完成 ✅
- [x] 量价背离分级系统
- [x] Hyperliquid资金费率集成
- [x] 聪明钱包OI追踪
- [x] 多数据源支持（Hyperliquid + Binance）
- [x] 数据持久化
- [x] 用户自定义交易对配置

### 计划中 🚧
- [ ] 实盘小资金验证（SOL，2周）
- [ ] 根据实盘结果调整参数
- [ ] 添加更多数据源（OKX, Bybit）
- [ ] WebSocket实时数据流
- [ ] Telegram通知集成

---

## 📞 联系方式

- **作者**: hins chow
- **版本**: v7.2 (Stage2.2)
- **最后更新**: 2025-10-28

---

## ⚖️ 免责声明

本项目仅供学习和研究使用，不构成任何投资建议。

数字货币交易具有极高风险，可能导致本金全部损失。请在充分了解风险的前提下谨慎使用，风险自负。

**强烈建议**：
1. 先进行充分的回测验证
2. 使用小资金测试
3. 设置严格的止损
4. 不要使用借贷资金

---

**当前版本**: v7.2 (Stage2.2 - 多数据源支持)
